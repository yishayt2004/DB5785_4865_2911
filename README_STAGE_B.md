
# דוח שלב ב – תשאול מתקדם ושינויים

בשלב זה הרחבנו את בסיס הנתונים שלנו באמצעות שאילתות מורכבות, שינויים דינמיים, אילוצים ופקודות ניהול טרנזקציות (COMMIT / ROLLBACK).

---

## 1. שאילתות SELECT

### 1. ממוצע שכר לפי מחלקה
השאילתה מחשבת את ממוצע השכר של העובדים בכל מחלקה וממיינת מהגבוה לנמוך.
![ממוצע שכר לפי מחלקה](screenshots/צילום%20מסך%202025-05-06%20ב-18.19.41.png)


### 2. עובדים עם ציון הערכה מתחת ל־60 השנה
שולפת עובדים שהוערכו השנה בציון נמוך מ־60.  
![תוצאה](screenshots/%D7%A6%D7%99%D7%9C%D7%95%D7%9D%20%D7%9E%D7%A1%D7%9A%202025-05-06%20%D7%91-18.31.42.png)


### 3. הדרכות שבוצעו השנה
שולפת את רשימת ההדרכות של עובדים שבוצעו בשנה הנוכחית.  
### 4. מספר עובדים שעברו הדרכה בכל מחלקה
סופרת כמה עובדים עברו הדרכה בכל מחלקה.  
![תמונה](screenshots/%D7%A6%D7%99%D7%9C%D7%95%D7%9D%20%D7%9E%D7%A1%D7%9A%202025-05-06%20%D7%91-18.36.32.png)


### 5. עובדים שקיבלו שכר ראשון לפני יותר מ־60 יום
מאתרת עובדים ותיקים לפי תאריך תשלום ראשון.  
![תמונה](screenshots/%D7%A6%D7%99%D7%9C%D7%95%D7%9D%20%D7%9E%D7%A1%D7%9A%202025-05-06%20%D7%91-18.38.25.png)


### 6. עובדים שלא עברו הדרכה כלל
שולפת עובדים שמעולם לא השתתפו בהדרכה.  
![תמונה](screenshots/%D7%A6%D7%99%D7%9C%D7%95%D7%9D%20%D7%9E%D7%A1%D7%9A%202025-05-06%20%D7%91-18.39.45.png)


### 7. חישוב שעות משמרת יומית
מציגה את אורך המשמרת (בשעות) לכל עובד לכל יום.  
![תמונה](screenshots/%D7%A6%D7%99%D7%9C%D7%95%D7%9D%20%D7%9E%D7%A1%D7%9A%202025-05-06%20%D7%91-18.42.10.png)


### 8. השוואת שכר נטו לעובדים משתכרים גבוה
שולפת עובדים עם שכר ברוטו גבוה מ־10,000 ש"ח ומציגה את השכר לאחר ניכויים.  
![תמונה](screenshots/%D7%A6%D7%99%D7%9C%D7%95%D7%9D%20%D7%9E%D7%A1%D7%9A%202025-05-06%20%D7%91-18.43.16.png)


---

## 2. עדכונים ומחיקות

### UPDATE 1 – העלאת שכר ב־10% לעובדים עם ותק של שנה
📷 *הוסף כאן צילום הרצה*  
📷 *הוסף כאן צילום לפני העדכון*  
📷 *הוסף כאן צילום אחרי העדכון*

### UPDATE 2 – העלאת ציון הערכה לעובדים עם הדרכה מתקדמת
📷 *הוסף כאן צילום הרצה*  
📷 *הוסף כאן צילום לפני העדכון*  
📷 *הוסף כאן צילום אחרי העדכון*

### UPDATE 3 – שינוי תפקיד לעובדים שלא עברו הדרכה
📷 *הוסף כאן צילום הרצה*  
📷 *הוסף כאן צילום לפני העדכון*  
📷 *הוסף כאן צילום אחרי העדכון*

### DELETE 1 – מחיקת הערכות עם ציון נמוך מ־40
📷 *הוסף כאן צילום הרצה*  
📷 *הוסף כאן צילום לפני המחיקה*  
📷 *הוסף כאן צילום אחרי המחיקה*

### DELETE 2 – מחיקת הדרכות שלא הושלמו
📷 *הוסף כאן צילום הרצה*  
📷 *הוסף כאן צילום לפני המחיקה*  
📷 *הוסף כאן צילום אחרי המחיקה*

### DELETE 3 – מחיקת משמרות עתידיות
📷 *הוסף כאן צילום הרצה*  
📷 *הוסף כאן צילום לפני המחיקה*  
📷 *הוסף כאן צילום אחרי המחיקה*

---

## 3. אילוצים (Constraints)

### אילוץ 1 – Position בטבלת Employee חייב להיות NOT NULL
הוספנו אילוץ שמחייב הזנת תפקיד לעובד.  
📷 *הוסף ניסיון הכנסה לא תקינה וקבלת שגיאה*

### אילוץ 2 – Deductions בטבלת Payroll בטווח 0–5000 (CHECK)
הגדרנו הגבלה על גובה הניכוי מהשכר.  
📷 *הוסף ניסיון הכנסה לא תקינה וקבלת שגיאה*

### אילוץ 3 – ברירת מחדל לעמודת Description במחלקה
אם לא מציינים תיאור, ייקבע ערך ברירת מחדל.  
📷 *הוסף ניסיון הכנסה ללא תיאור והצגת ערך שנקבע אוטומטית*

---

## 4. שימוש ב־ROLLBACK / COMMIT

### דוגמה ל־ROLLBACK – העלאת שכר וביטול
📷 *לפני השינוי*  
📷 *לאחר שינוי שכר*  
📷 *לאחר ביצוע ROLLBACK – חזרה למצב המקורי*

### דוגמה ל־COMMIT – עדכון ציון ושמירה
📷 *לפני שינוי הציון*  
📷 *לאחר עדכון*  
📷 *לאחר COMMIT – שמירה לצמיתות*

---
